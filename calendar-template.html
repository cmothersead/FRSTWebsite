<script src="https://apis.google.com/js/api.js"></script>
<script>
    function load() {
        gapi.load("client", init);
    }

    function init() {
        gapi.client.init({
            'apiKey': 'AIzaSyAjbzmiW3uXLXc72fsCloea3U9zO6bke0Y',
            'discoveryDocs': ['https://content.googleapis.com/discovery/v1/apis/calendar/v3/rest']
        });
        createAndFillCalendar(2021, 9)
    }
    var month = new Date().getMonth();
    var year = new Date().getFullYear();
    var validCells;

    function changeMonth(forward) {
        if (forward) {
            if (month == 11) {
                year++;
                month = 0;
            } else {
                month++;
            }
        } else {
            if (month == 0) {
                year--;
                month = 11;
            } else {
                month--;
            }
        }
        destroyCalendar();
        createAndFillCalendar(year, month);
    }

    function destroyCalendar() {
        var calendar = document.getElementById("calendar");
        Array.from(calendar.children).forEach(child => calendar.removeChild(child));
    }

    function createAndFillCalendar(year, month) {
        createCalendar(year, month);
        fillCalendar(year, month);
    }

    function createCalendar(year, month) {
        var calendar = document.getElementById("calendar");
        var date = new Date(year, month, 1);
        var first = new Date(date.getFullYear(), date.getMonth(), 1);
        var last = new Date(date.getFullYear(), date.getMonth() + 1, 0);
        var month = date.toLocaleString('default', {
            month: 'long'
        })
        var year = date.getFullYear();
        document.getElementById("month").innerHTML = month;
        document.getElementById("year").innerHTML = year;

        for (let i = 0; i < numWeeks(last.getDate(), first.getDay()); i++) {
            addRow(calendar);
        }

        var dates = [];
        var contents = [];
        var dateRows = Array.from(calendar.getElementsByClassName("date-row"));
        var contentRows = Array.from(calendar.getElementsByClassName("content-row"));
        dateRows.forEach(row => dates.push.apply(dates, Array.from(row.children)));
        contentRows.forEach(row => contents.push.apply(contents, Array.from(row.children)));
        var cells = dates.map((date, index) => date = {
            dateValue: 0,
            dateCell: dates[index],
            contentsCell: contents[index]
        })
        cells.forEach((cell, index) => {
            var value = index + 1 - first.getDay();
            if (value >= 1 && value <= last.getDate()) {
                cell.dateValue = value;
                cell.dateCell.innerHTML = value;
            } else {
                cell.dateCell.className = "empty";
                cell.contentsCell.className = "empty";
            }
        });
        validCells = cells.filter(cell => cell.dateValue != 0);
    }

    function fillCalendar(year, month) {
        return gapi.client.calendar.events.list({
                "calendarId": "c_classroom443edbdc@group.calendar.google.com",
                'orderBy': 'startTime',
                "singleEvents": true
            })
            .then(function(response) {
                    var events = response.result.items;
                    if (events.length > 0) {
                        events = Array.from(events);
                        var practices = events.filter(event => event.summary.includes("Practice") && !event.summary.includes("No Practice"))
                            .map(event => event = {
                                start: new Date(event.start.dateTime ? event.start.dateTime : event.start.date),
                                end: new Date(event.end.dateTime ? event.end.dateTime : event.end.date),
                            })
                            .filter(event => event.start.getFullYear() == year && event.start.getMonth() == month);
                        practices.forEach(practice =>
                            validCells[practice.start.getDate() - 1].contentsCell.innerHTML += "<div" + (practice.start.getHours() < 12 ? " class=\"time-am\">" : ">") +
                            practice.start.toLocaleTimeString([], {
                                hour: 'numeric',
                                minute: 'numeric'
                            }) + '-' + practice.end.toLocaleTimeString([], {
                                hour: 'numeric',
                                minute: 'numeric'
                            }) + "</div>");
                    }
                },
                function(err) {
                    console.error("Execute error", err);
                });
    }

    function addEvent(container) {

    }

    function numWeeks(numDays, startDay) {
        return Math.ceil((numDays + startDay) / 7);
    }

    function addRow(calendar) {
        var dateRow = document.createElement("tr");
        dateRow.className = "date-row";
        var contentRow = document.createElement("tr");
        contentRow.className = "content-row";
        for (let i = 0; i < 7; i++) {
            dateRow.appendChild(document.createElement("td"));
            contentRow.appendChild(document.createElement("td"));
        }
        calendar.appendChild(dateRow);
        calendar.appendChild(contentRow);
    }
</script>
<style type="text/css">
    table {
        border: 1px solid black;
        background-color: lightgray;
        border-collapse: collapse;
        user-select: none;
        empty-cells: hide;
    }
    
    tbody {
        border: 1px solid black;
        background-color: white;
    }
    /* #region Banner */
    
    .banner {
        margin-bottom: 20px;
        border: 1px solid black;
        height: 100px;
        width: 100%;
        display: flex;
        justify-content: space-between;
        user-select: none;
        background: black;
    }
    
    .banner div {
        display: flex;
        align-items: center;
        flex-grow: 1;
    }
    
    .banner div div {
        flex-grow: unset;
    }
    
    .group-name {
        font-family: 'Impact';
        font-size: 48pt;
        color: white;
        text-shadow: black -1px 1px 3px;
        background: linear-gradient(to bottom right, #585858, gray);
    }
    
    .date-selector {
        background: linear-gradient(to bottom right, #4285f4, #004aad);
        justify-content: end;
    }
    
    .icon {
        height: 33px;
        width: 33px;
        background: gray;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        border: 2px solid gray;
        cursor: pointer;
        margin: 10px;
        transition: 0.2s;
    }
    
    .icon:hover {
        background: white;
    }
    
    .icon svg {
        color: white;
        transition: 0.2s;
    }
    
    .icon:hover svg {
        color: black;
    }
    
    #month {
        font-family: 'docs-Roboto', Arial;
        font-size: 26pt;
        width: 160px;
        color: white;
        justify-content: center;
    }
    
    #year {
        font-family: 'docs-Roboto', Arial;
        font-size: 40pt;
        font-weight: bold;
        color: black;
        border-left: 3px solid black;
        padding: 10px;
    }
    /* #endregion */
    /* #region Calendar */
    
    .empty {
        background: lightgray;
    }
    
    .days-row {
        height: 20px;
        text-align: center;
        font-weight: bold;
        color: #ffffff;
        font-family: 'docs-Lora', Arial;
        font-size: 10pt;
    }
    
    .days-row th {
        width: 160px;
        border: 1px solid #000000;
    }
    
    .weekday {
        background-color: #4285f4;
    }
    
    .weekend {
        background-color: #999999;
    }
    
    #calendar .date-row {
        height: 20px;
    }
    
    #calendar .date-row td {
        border: 1px dotted black;
        text-align: right;
        font-family: 'Arial';
        font-size: 10pt;
        vertical-align: middle;
        padding-right: 3px;
    }
    
    #calendar .content-row {
        height: 100px;
    }
    
    #calendar .content-row td {
        border: 1px dotted black;
        color: #1155cc;
        font-family: 'docs-Roboto', Arial;
        font-size: 11pt;
        font-weight: bold;
        text-align: center;
        vertical-align: middle;
    }
    /* #endregion */
    /* #region Events */
    
    .events td {
        border-left: 1px solid black;
        border-right: 1px solid black;
    }
    
    .events .date-row {
        height: 20px;
        border-bottom: 1px dotted black;
    }
    
    .events .date-row td {
        font-family: 'Arial';
        font-size: 10pt;
        font-weight: bold;
        vertical-align: middle;
        padding: 2px;
    }
    
    .events .title-row {
        height: 20px;
        border-bottom: 1px solid lightgray;
    }
    
    .events .title-row td {
        color: #ff0000;
        font-family: 'Georgia';
        font-size: 10pt;
        font-weight: bold;
        vertical-align: bottom;
        padding: 3px;
    }
    
    .events .description-row {
        height: 60px;
    }
    
    .events .description-row td {
        font-family: 'Georgia';
        font-size: 8pt;
        vertical-align: top;
        padding: 3px;
    }
    
    .events .label {
        border: 1px solid black;
        color: #434343;
    }
    /* #endregion */
    /* #region Modifiers */
    
    .time-am {
        color: #434343;
    }
    
    .time-changed {
        color: #ea4335;
    }
    
    .location-fcms {
        color: #4285f4;
    }
    
    .location-fcms::after {
        content: "@FCMS";
    }
    
    .location-ffac {
        color: #6aa84f;
    }
    
    .location-ffac::after {
        content: "@FFAC";
    }
    /* #endregion */
</style>

<body onload="load()">
    <div style="margin: 20px; display: inline-block;">
        <div class="banner">
            <div class="group-name">
                <img src="images/logos/teams/FRST/white&black512x512.png" alt="FRST" style="height: 170px; margin: 10px; object-fit: cover;" />
                <span style="padding-right: 20px;">Eclipse</span>
            </div>
            <img src="images/calendar/banner.png" style="width: 330px; margin-right: -10px; margin-left: -10px; z-index: 1; object-fit: cover; object-position: 50% 65%;" />
            <div class="date-selector">
                <button class="icon" onclick="changeMonth(false)">
                    <svg aria-hidden=" true " focusable="false " role="img " viewBox="0 0 207 320 " style="height: 50%; padding-right:5px;">
                    <path fill="currentColor"
                          d="M 7.0375496,143.05 143.03755,7.05 c 9.4,-9.4 24.6,-9.4 33.9,0 l 22.6,22.6 c 9.4,9.4 9.4,24.6 0,33.9 l -96.3,96.5 96.4,96.4 c 9.4,9.4 9.4,24.6 0,33.9 l -22.6,22.7 c -9.4,9.4 -24.6,9.4 -33.9,0 L 7.1375496,177.05 c -9.5,-9.4 -9.5,-24.6 -0.1,-34 z "/>
                </svg>
                </button>
                <div id="month"></div>
                <button class="icon" onclick="changeMonth(true)">
                    <svg aria-hidden=" true " focusable="false " role="img " viewBox="0 0 207 320 " style="height: 50%; padding-left:3px">
                    <path fill="currentColor"
                          d="m 199.65,143.05 -136,-136 c -9.4,-9.4 -24.6,-9.4 -33.9,0 l -22.6,22.6 c -9.4,9.4 -9.4,24.6 0,33.9 l 96.3,96.5 -96.4,96.4 c -9.4,9.4 -9.4,24.6 0,33.9 l 22.6,22.7 c 9.4,9.4 24.6,9.4 33.9,0 l 136,-136 c 9.5,-9.4 9.5,-24.6 0.1,-34 z"/>
                </svg>
                </button>
                <div id="year"></div>
            </div>
        </div>
        <table>
            <thead>
                <tr class="days-row">
                    <th class="weekend">Sunday</th>
                    <th class="weekday">Monday</th>
                    <th class="weekday">Tuesday</th>
                    <th class="weekday">Wednesday</th>
                    <th class="weekday">Thursday</th>
                    <th class="weekday">Friday</th>
                    <th class="weekend">Saturday</th>
                </tr>
            </thead>
            <tbody id="calendar">
                <tr>
                </tr>
            </tbody>
            <tbody>
                <tr style="height: 19px">
                    <td colspan="7"></td>
                </tr>
            </tbody>
            <tbody class="events">
                <tr class="date-row">
                    <td rowspan="3">
                        <div style="width:160px;height:99px;">
                            <img src="https://lh3.googleusercontent.com/W0izecp5q_UmJpZO1uWrMHGewGEEV4kk_DqrlsI17zFUNeaMp-SmvuPOXGMSi05tUfuzUwVexIh_9tZPTH5uhVSYARDVJRw1vkgEvYiEq_T1OqdM48OpG9rQEu9S3wWtve9CwbuF3w=w160-h99" style="width:inherit;height:inherit;object-fit:scale-down;object-position:center center;"
                            />
                        </div>
                    </td>
                    <td class="label" style="font-family: 'docs-Roboto', Arial; font-size: 36pt; padding-left: 10px;" colspan="2" rowspan="3">Events</td>
                    <td colspan="2">8/16</td>
                    <td colspan="2">8/17-18</td>
                </tr>
                <tr class="title-row">
                    <td colspan="2">First Day of Practice</td>
                    <td colspan="2">New Athlete Registration</td>
                </tr>
                <tr class="description-row">
                    <td colspan="2">We will begin the Short Course Season after a 2 week break to give the kids some time away from the water to get adjusted to the return to school &amp; life after summer.
                    </td>
                    <td colspan="2">Although not particularly important for this group, FRST will hold its registration/evaluation nights on the Tuesday/Wednesday of the first week of practice</td>
                </tr>
            </tbody>
        </table>
    </div>
    <button onclick="fillCalendar(2021, 9)">execute</button>
</body>